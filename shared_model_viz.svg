<svg viewBox="0 0 1200 1400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3b82f6" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1f2937">
    SharedModel Architecture
  </text>
  
  <!-- Input Layer -->
  <rect x="500" y="70" width="200" height="60" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2" rx="5"/>
  <text x="600" y="95" font-size="14" font-weight="bold" text-anchor="middle" fill="#1f2937">INPUT</text>
  <text x="600" y="115" font-size="12" text-anchor="middle" fill="#4b5563">states (observation_space)</text>
  
  <!-- Shared Network Container -->
  <rect x="450" y="180" width="300" height="400" fill="#fef3c7" stroke="#f59e0b" stroke-width="3" rx="8" stroke-dasharray="5,5"/>
  <text x="600" y="200" font-size="16" font-weight="bold" text-anchor="middle" fill="#92400e">
    Shared Network Container
  </text>
  
  <!-- Layer 1 -->
  <rect x="480" y="230" width="240" height="60" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="600" y="255" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e40af">LazyLinear(400)</text>
  <text x="600" y="275" font-size="11" text-anchor="middle" fill="#1e40af">+ ELU activation</text>
  
  <!-- Layer 2 -->
  <rect x="480" y="320" width="240" height="60" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="600" y="345" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e40af">LazyLinear(200)</text>
  <text x="600" y="365" font-size="11" text-anchor="middle" fill="#1e40af">+ ELU activation</text>
  
  <!-- Layer 3 -->
  <rect x="480" y="410" width="240" height="60" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="600" y="435" font-size="13" font-weight="bold" text-anchor="middle" fill="#1e40af">LazyLinear(100)</text>
  <text x="600" y="455" font-size="11" text-anchor="middle" fill="#1e40af">+ ELU activation</text>
  
  <!-- Shared Output -->
  <rect x="500" y="510" width="200" height="50" fill="#fcd34d" stroke="#f59e0b" stroke-width="2" rx="5"/>
  <text x="600" y="530" font-size="13" font-weight="bold" text-anchor="middle" fill="#92400e">Shared Output</text>
  <text x="600" y="548" font-size="10" text-anchor="middle" fill="#92400e">(cached if needed)</text>
  
  <!-- Arrows for shared network -->
  <line x1="600" y1="130" x2="600" y2="230" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="290" x2="600" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="380" x2="600" y2="410" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="470" x2="600" y2="510" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Split indicator -->
  <text x="600" y="605" font-size="18" font-weight="bold" text-anchor="middle" fill="#dc2626">
    âŸ± SPLIT âŸ°
  </text>
  
  <!-- Policy Branch (Left) -->
  <g id="policy-branch">
    <rect x="100" y="650" width="350" height="300" fill="#dcfce7" stroke="#10b981" stroke-width="3" rx="8"/>
    <text x="275" y="680" font-size="16" font-weight="bold" text-anchor="middle" fill="#065f46">
      POLICY BRANCH (role="policy")
    </text>
    
    <!-- Policy Layer -->
    <rect x="150" y="710" width="250" height="60" fill="#a7f3d0" stroke="#10b981" stroke-width="2" rx="5"/>
    <text x="275" y="735" font-size="13" font-weight="bold" text-anchor="middle" fill="#065f46">Policy Layer</text>
    <text x="275" y="755" font-size="11" text-anchor="middle" fill="#065f46">LazyLinear(num_actions)</text>
    
    <!-- Log Std Parameter -->
    <rect x="150" y="800" width="250" height="60" fill="#a7f3d0" stroke="#10b981" stroke-width="2" rx="5"/>
    <text x="275" y="820" font-size="13" font-weight="bold" text-anchor="middle" fill="#065f46">Log Std Parameter</text>
    <text x="275" y="835" font-size="10" text-anchor="middle" fill="#065f46">nn.Parameter([num_actions])</text>
    <text x="275" y="850" font-size="10" text-anchor="middle" fill="#065f46">init=0.0, requires_grad=True</text>
    
    <!-- Policy Output -->
    <rect x="150" y="890" width="250" height="40" fill="#6ee7b7" stroke="#10b981" stroke-width="2" rx="5"/>
    <text x="275" y="915" font-size="12" font-weight="bold" text-anchor="middle" fill="#065f46">Gaussian Distribution</text>
  </g>
  
  <!-- Value Branch (Right) -->
  <g id="value-branch">
    <rect x="750" y="650" width="350" height="300" fill="#ddd6fe" stroke="#8b5cf6" stroke-width="3" rx="8"/>
    <text x="925" y="680" font-size="16" font-weight="bold" text-anchor="middle" fill="#5b21b6">
      VALUE BRANCH (role="value")
    </text>
    
    <!-- Value Layer -->
    <rect x="800" y="750" width="250" height="60" fill="#c4b5fd" stroke="#8b5cf6" stroke-width="2" rx="5"/>
    <text x="925" y="775" font-size="13" font-weight="bold" text-anchor="middle" fill="#5b21b6">Value Layer</text>
    <text x="925" y="795" font-size="11" text-anchor="middle" fill="#5b21b6">LazyLinear(1)</text>
    
    <!-- Value Output -->
    <rect x="800" y="890" width="250" height="40" fill="#a78bfa" stroke="#8b5cf6" stroke-width="2" rx="5"/>
    <text x="925" y="915" font-size="12" font-weight="bold" text-anchor="middle" fill="#5b21b6">Value Estimate (scalar)</text>
  </g>
  
  <!-- Connection arrows -->
  <line x1="600" y1="560" x2="275" y2="650" stroke="#10b981" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <line x1="600" y1="560" x2="925" y2="650" stroke="#8b5cf6" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <line x1="275" y1="770" x2="275" y2="800" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <line x1="275" y1="860" x2="275" y2="890" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <line x1="925" y1="810" x2="925" y2="890" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Mixins Info -->
  <rect x="50" y="1000" width="500" height="180" fill="#fef2f2" stroke="#ef4444" stroke-width="2" rx="5"/>
  <text x="300" y="1025" font-size="14" font-weight="bold" text-anchor="middle" fill="#991b1b">
    GaussianMixin (Policy)
  </text>
  <text x="300" y="1045" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ clip_actions=False
  </text>
  <text x="300" y="1065" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ clip_log_std=True (min=-20.0, max=2.0)
  </text>
  <text x="300" y="1085" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ reduction="sum"
  </text>
  <text x="300" y="1105" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ Outputs: (mean, log_std, extras)
  </text>
  <text x="300" y="1125" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ Samples actions from Gaussian distribution
  </text>
  <text x="300" y="1145" font-size="11" text-anchor="middle" fill="#7f1d1d">
    â€¢ Used for stochastic policy exploration
  </text>
  
  <rect x="650" y="1000" width="500" height="180" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2" rx="5"/>
  <text x="900" y="1025" font-size="14" font-weight="bold" text-anchor="middle" fill="#5b21b6">
    DeterministicMixin (Value)
  </text>
  <text x="900" y="1045" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ clip_actions=False
  </text>
  <text x="900" y="1065" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ role="value"
  </text>
  <text x="900" y="1085" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ Outputs: (value, extras)
  </text>
  <text x="900" y="1105" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ Returns deterministic value estimate
  </text>
  <text x="900" y="1125" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ Used for state value function approximation
  </text>
  <text x="900" y="1145" font-size="11" text-anchor="middle" fill="#5b21b6">
    â€¢ Critic in Actor-Critic architecture
  </text>
  
  <!-- Key Features -->
  <rect x="50" y="1230" width="1100" height="140" fill="#f0fdf4" stroke="#22c55e" stroke-width="2" rx="5"/>
  <text x="600" y="1255" font-size="15" font-weight="bold" text-anchor="middle" fill="#166534">
    ðŸ”‘ Key Architecture Features
  </text>
  <text x="80" y="1285" font-size="12" text-anchor="start" fill="#166534">
    1. <tspan font-weight="bold">Shared Network Container:</tspan> 3-layer network (400â†’200â†’100) processes observations once for both policy and value
  </text>
  <text x="80" y="1305" font-size="12" text-anchor="start" fill="#166534">
    2. <tspan font-weight="bold">Efficient Computation:</tspan> Caches shared output (_shared_output) when both heads are used in sequence
  </text>
  <text x="80" y="1325" font-size="12" text-anchor="start" fill="#166534">
    3. <tspan font-weight="bold">Actor-Critic Architecture:</tspan> Policy outputs action distribution (mean + log_std), Value outputs state value estimate
  </text>
  <text x="80" y="1345" font-size="12" text-anchor="start" fill="#166534">
    4. <tspan font-weight="bold">Role-based Routing:</tspan> act() and compute() methods dispatch to appropriate mixin based on "policy" or "value" role
  </text>
</svg>